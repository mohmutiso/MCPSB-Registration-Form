<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>MCPSB Attendance Register</title>

<link rel="stylesheet" href="/static/styles.css">

<style>

/* SUCCESS OVERLAY */

.success-overlay{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.6);
    display:none;
    justify-content:center;
    align-items:center;
    z-index:9999;
}

.success-box{
    background:white;
    padding:40px;
    border-radius:12px;
    text-align:center;
    max-width:420px;
    animation:scaleIn .3s ease;
}

.checkmark{
    font-size:60px;
    color:#2ecc71;
}

.success-box button{
    margin-top:20px;
    padding:10px 20px;
    border:none;
    background:#0052cc;
    color:white;
    border-radius:6px;
    cursor:pointer;
}

@keyframes scaleIn{
from{transform:scale(.8);opacity:0;}
to{transform:scale(1);opacity:1;}
}

</style>

</head>

<body>

<!-- SUCCESS CARD -->

<div id="successCard" class="success-overlay">

<div class="success-box">

<div class="checkmark">✓</div>

<h2>Attendance Registered Successfully</h2>

<p>
Thank you, you have successfully registered attendance for
<strong>MCPSB Meeting</strong>.
</p>

<button onclick="location.reload()">Register Another Person</button>

</div>

</div>

<!-- HEADER -->

<div class="header">

<img src="/static/county_logo.png" class="logo">

<h1>MAKUENI COUNTY PUBLIC SERVICE BOARD</h1>

<p>
P.O BOX 49 – 90300 MAKUENI Tel:0202026751<br>
EMAIL: cpsb@makueni.go.ke<br>
Web: www.makuenipsb.go.ke
</p>

</div>

<!-- FORM -->

<form id="attendanceForm">

<h2>MCPSB Attendance Register</h2>

<h3>SECTION A: PERSONAL PARTICULARS</h3>

<label>Title</label>
<select name="title" id="titleSelect" onchange="toggleCustomTitle()" required>
<option value="">Select</option>
<option>Mr.</option>
<option>Mrs.</option>
<option>Ms.</option>
<option>Dr.</option>
<option>Prof.</option>
<option>Eng.</option>
<option>CPA</option>
<option>FCPA</option>
<option value="Other">Other (Specify)</option>
</select>

<input type="text" id="customTitle" name="custom_title" placeholder="Enter custom title" style="display:none;">

<label>First Name</label>
<input type="text" name="first_name" required>

<label>Surname</label>
<input type="text" name="surname" required>

<label>Other Name(s)</label>
<input type="text" name="other_names">

<label>ID / Payroll Number</label>
<input type="text" name="id_number" required>

<label>Designation</label>
<input type="text" name="designation" required>

<label>Department/Organization</label>
<input type="text" name="organization" required>

<h3>SECTION B: DEMOGRAPHIC INFORMATION</h3>

<label>Gender</label>
<div class="radio-group">
<input type="radio" name="gender" value="Male" required> Male
<input type="radio" name="gender" value="Female"> Female
<input type="radio" name="gender" value="Prefer not to say"> Prefer not to say
</div>

<label>PWD</label>
<div class="radio-group">
<input type="radio" name="pwd" value="Yes" onclick="togglePWD(true)"> Yes
<input type="radio" name="pwd" value="No" onclick="togglePWD(false)"> No
</div>

<div id="pwdDetails" class="checkbox-group" style="display:none;">
<input type="checkbox" name="disability_category" value="Physical"> Physical
<input type="checkbox" name="disability_category" value="Visual"> Visual
<input type="checkbox" name="disability_category" value="Hearing"> Hearing
<input type="checkbox" name="disability_category" value="Intellectual"> Intellectual
</div>

<h3>SECTION C</h3>

<canvas id="signatureCanvas"></canvas>

<button type="button" onclick="clearSignature()">Clear Signature</button>

<input type="hidden" name="signature" id="signatureInput">

<label>Date</label>
<input type="text" name="date" id="dateInput" readonly>

<label>Time</label>
<input type="text" name="time" id="timeInput" readonly>

<label>
<input type="checkbox" name="declaration" required>
I hereby declare that the information provided is true.
</label>

<button type="submit">Submit</button>

</form>

<script>

/* UI */

function toggleCustomTitle(){
const select=document.getElementById("titleSelect");
const custom=document.getElementById("customTitle");

if(select.value==="Other"){
custom.style.display="block";
custom.required=true;
}else{
custom.style.display="none";
custom.required=false;
}
}

function togglePWD(show){
document.getElementById("pwdDetails").style.display=show?"flex":"none";
}

const now=new Date();
dateInput.value=now.toLocaleDateString();
timeInput.value=now.toLocaleTimeString();

/* SIGNATURE */

const canvas=document.getElementById("signatureCanvas");
const ctx=canvas.getContext("2d");
let drawing=false;

canvas.addEventListener("mousedown",()=>drawing=true);
canvas.addEventListener("mouseup",()=>drawing=false);
canvas.addEventListener("mousemove",draw);

function draw(e){
if(!drawing)return;
const rect=canvas.getBoundingClientRect();
ctx.lineWidth=2;
ctx.lineCap="round";
ctx.lineTo(e.clientX-rect.left,e.clientY-rect.top);
ctx.stroke();
ctx.beginPath();
ctx.moveTo(e.clientX-rect.left,e.clientY-rect.top);
}

function clearSignature(){
ctx.clearRect(0,0,canvas.width,canvas.height);
}

/* SUBMIT */

document.getElementById("attendanceForm").addEventListener("submit", async function(e){

e.preventDefault();

signatureInput.value=canvas.toDataURL();

const formData=new FormData(this);

const response=await fetch("/submit-form/",{
method:"POST",
body:formData
});

const result=await response.json();

if(result.status==="success"){

document.getElementById("successCard").style.display="flex";

}

else if(result.status==="duplicate"){

alert("This ID already registered.");

}else{

alert("Error submitting form.");

}

});

</script>

</body>
</html>
